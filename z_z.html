<?php

namespace Database\Seeders;
use App\Models\Store;
use App\Models\Customer;
use App\Models\Campaign;
use App\Models\CampaignProcess;
use App\Events\Database\CreatedModel;
use Illuminate\Support\Facades\Schema;
use Illuminate\Database\Seeder;

class DatabaseSeeder extends Seeder
{
    /**
     * Seed the application's database.
     *
     * @return void
     */
    private static $store_id =1;
    private static $customer_id =1;
    private static $campaign_id =1;
    private static $campaignProcess_id =1;

    public function run()
    {
        // Schema::connection($dbModel->name)->disableForeignKeyConstraints();
        //     $model::on($dbModel->name)->create($dataCreatedModel);
        // Schema::connection($dbModel->name)->enableForeignKeyConstraints();
        $stores =  Store::factory(5)->create();
        foreach ($stores as  $store) {
            $store->id = self::$store_id++;
            Store::on('mysql_stores_backup')->create(($store->toArray()));
        }

        $stores =  Store::factory(5)->create()->each(function($store)  {
            $customers = Customer::factory(5)->create([
                'store_id' => $store->id
            ]);
            foreach ($customers as  $customer) {
            $customer->id = self::$customer_id++;
            Customer::on('mysql_customers_backup')->create(($customer->toArray()));
            Customer::on('mysql_customers_backup_1')->create(($customer->toArray()));
        }

            $campaigns = Campaign::factory(2)->create([
                'store_id' => $store->id
            ])->each(function($campaign)  {
                $campaignProcesses = CampaignProcess::factory(5)->create([
                    'store_id' => $campaign->store_id,
                    'campaign_id' => $campaign->id
                ]);
                 foreach ($campaignProcesses as  $campaignProcess) {
                    $campaignProcess->id = self::$campaignProcess_id++;
                    CampaignProcess::on('mysql_campaigns_processes_backup')->create(($campaignProcess->toArray()));

                }
            });
            foreach ($campaigns as  $campaign) {
            $campaign->id = self::$campaign_id++;
            Campaign::on('mysql_campaigns_backup')->create(($campaign->toArray()));

        }


        });
        foreach ($stores as  $store) {
            $store->id = self::$store_id++;
            // info("data_fake_store_id: ".$store->id);
            Store::on('mysql_stores_backup')->create(($store->toArray()));
        }
        // \App\Models\User::factory(10)->create();
        // $this->call(UserSeeder::class);
        // $this->call(StoreSeeder::class);
        // $this->call(CustomerSeeder::class);
        // $this->call(CampaignSeeder::class);
        // $this->call(CampaignProcessSeeder::class);
    }
}
